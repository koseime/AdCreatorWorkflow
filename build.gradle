apply plugin: 'com.github.johnrengelman.shadow'
apply plugin: 'protobuf'
apply plugin: 'distribution'

buildscript {
    apply from: "http://repository-kosei.forge.cloudbees.com/release/com/kosei/services/common-shared/${commonVersion}/common-shared-${commonVersion}-buildscript.gradle", to: buildscript
    dependencies { 
        classpath 'ws.antonov.gradle.plugins:gradle-plugin-protobuf:0.9.1'
    }    
}

apply from: "http://repository-kosei.forge.cloudbees.com/release/com/kosei/services/common-shared/${commonVersion}/common-shared-${commonVersion}-base.gradle"
apply from: "http://repository-kosei.forge.cloudbees.com/release/com/kosei/services/common-shared/${commonVersion}/common-shared-${commonVersion}-release.gradle"

project.ext { 
    protoc = project.hasProperty('protoc') ? protoc : 'protoc'
}

// Use Java 7 by default
sourceCompatibility = '1.7'
targetCompatibility = '1.7'

dependencies {
    compile( 
        'org.apache.hadoop:hadoop-common:2.2.0',
        'org.apache.hadoop:hadoop-client:2.2.0',
        'org.jdom:jdom:1.1.3',
        'com.google.protobuf:protobuf-java:2.5.0',
        'com.googlecode.json-simple:json-simple:1.1.1'
    )
    testCompile(
        'org.apache.mrunit:mrunit:1.0.0:hadoop2'
    )
}

distributions {
    config {
        contents {
            baseName = rootProject.name + '-config'
            into('/') {
                from 'oozie'
            }
        }
    }
}

artifacts {
    archives shadowJar
    archives configDistTar
}

task run(type: JavaExec, dependsOn: classes) {
    classpath sourceSets.main.runtimeClasspath
    main mainClassName
    args ''
}

protocPath = protoc
protobufCodeGenPlugins = ["cpp:${protocPath}"]

shadowJar { 
    dependencies { 
        include(dependency('org.jdom:jdom:1.1.3'))
        include(dependency('com.google.protobuf:protobuf-java:2.5.0'))
        include(dependency('com.googlecode.json-simple:json-simple:1.1'))
    }
}
